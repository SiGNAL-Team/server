<!-- prettier-ignore -->
{% extends "ustc/base.html" %}
{% load i18n %}
{% load ustc_extras %}
{% block title %}{% trans "Courses" %} - {% trans "SiGNAL" %}{% endblock %}

{% block content %}
{% trans "N/A" as na_text %}

<div class="list-header">
  <div class="list-title-row">
    <h1>{% trans "Courses" %}</h1>
    <form method="get" class="list-filter-form" id="search-form">
      <input 
        type="text" 
        name="q" 
        class="form-control list-filter-input search me-2" 
        placeholder="{% trans 'Search by name or code...' %}" 
        value="{{ request.GET.q|default:'' }}"
      />
      <select name="type" class="form-select list-filter-input select me-2">
        <option value="">{% trans "All Course Types" %}</option>
        {% for type in course_types %}
        <option value="{{ type.id }}" {% if request.GET.type == type.id|stringformat:"i" %}selected{% endif %}>
          {{ type|translated_name }}
        </option>
        {% endfor %}
      </select>
      <select name="education_level" class="form-select list-filter-input select me-2">
        <option value="">{% trans "All Education Levels" %}</option>
        {% for level in education_levels %}
        <option value="{{ level.id }}" {% if request.GET.education_level == level.id|stringformat:"i" %}selected{% endif %}>
          {{ level|translated_name }}
        </option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-primary">{% trans "Filter" %}</button>
    </form>
  </div>
</div>

<!-- {% trans "courses" %} -->
{% include 'ustc/partials/result_count.html' with item_name="courses" %}

<div class="list-table-container">
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>{% trans "Code" %}</th>
          <th>{% trans "Name" %}</th>
          <th>{% trans "Type" %}</th>
          <th>{% trans "Education Level" %}</th>
          <th>{% trans "Gradation" %}</th>
          <th>{% trans "Category" %}</th>
          <th>{% trans "Class Type" %}</th>
          <th>{% trans "Classify" %}</th>
        </tr>
      </thead>
      <tbody>
        {% for course in courses %}
        <tr class="clickable-row" onclick="window.location='{% url 'ustc:course-detail' course.id %}'">
          <td>{{ course.code }}</td>
          <td>{{ course|translated_name }}</td>
          <td>{{ course.type|translated_name|default:na_text }}</td>
          <td>{{ course.education_level|translated_name|default:na_text }}</td>
          <td>{{ course.gradation|translated_name|default:na_text }}</td>
          <td>{{ course.category|translated_name|default:na_text }}</td>
          <td>{{ course.class_type|translated_name|default:na_text }}</td>
          <td>{{ course.classify|translated_name|default:na_text }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8">{% trans "No courses found." %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% include 'ustc/partials/pagination.html' %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const typeSelect = document.querySelector('select[name="type"]');
    const educationLevelSelect = document.querySelector('select[name="education_level"]');
    let searchTimeout;

    function performSearch() {
        const form = document.getElementById('search-form');
        if (form) {
            form.submit();
        }
    }

    // Instant filter on select changes
    if (typeSelect) {
        typeSelect.addEventListener('change', performSearch);
    }
    
    if (educationLevelSelect) {
        educationLevelSelect.addEventListener('change', performSearch);
    }
});
</script>
{% endblock %}
{% endblock %}
