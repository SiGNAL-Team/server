<!-- prettier-ignore -->
{% extends "ustc/base.html" %}
{% load i18n %}
{% load ustc_extras %}
{% block title %}{% trans "Sections" %} - {% trans "SiGNAL" %}{% endblock %}

{% block content %}
<div class="list-header">
  <div class="list-title-row">
    <h1>{% trans 'Course Sections' %}</h1>
    <form method="get" class="list-filter-form" id="search-form">
      <input 
        type="text" 
        name="q" 
        class="form-control list-filter-input search-compact me-2" 
        placeholder="{% trans 'Search by code...' %}" 
        value="{{ request.GET.q|default:'' }}"
      />
      <select name="semester" class="form-select list-filter-input select me-2">
        <option value="">{% trans 'All Semesters' %}</option>
        {% for sem in semesters %}
        <option value="{{ sem.id }}" {% if request.GET.semester == sem.id|stringformat:"i" %}selected{% endif %}>
          {{ sem.name }}
        </option>
        {% endfor %}
      </select>
      <select name="department" class="form-select list-filter-input select me-2">
        <option value="">{% trans 'All Departments' %}</option>
        {% for dept in departments %}
        <option value="{{ dept.id }}" {% if request.GET.department == dept.id|stringformat:"i" %}selected{% endif %}>
          {{ dept|translated_name }}
        </option>
        {% endfor %}
      </select>
      <button type="submit" class="btn btn-primary">{% trans 'Filter' %}</button>
    </form>
  </div>
</div>

<!-- {% trans "sections" %} -->
{% include 'ustc/partials/result_count.html' with item_name="sections" %}

<div class="list-table-container">
  {% include 'ustc/partials/section_table.html' with sections=sections show_semester=True empty_message="No sections found." %}
</div>

{% include 'ustc/partials/pagination.html' %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const semesterSelect = document.querySelector('select[name="semester"]');
    const departmentSelect = document.querySelector('select[name="department"]');
    let searchTimeout;

    function performSearch() {
        const form = document.getElementById('search-form');
        if (form) {
            form.submit();
        }
    }

    // Instant filter on select changes
    if (semesterSelect) {
        semesterSelect.addEventListener('change', performSearch);
    }
    
    if (departmentSelect) {
        departmentSelect.addEventListener('change', performSearch);
    }
});
</script>
{% endblock %}
{% endblock %}
